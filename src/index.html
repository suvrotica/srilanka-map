<!DOCTYPE html>
<html>
  <head>
    <title>Sri Lanka Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/main.css">
    <script>
      // Load API key from environment variable
      window.GOOGLE_MAPS_API_KEY = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;
    </script>
    <script async 
      src="https://maps.googleapis.com/maps/api/js?key=%VITE_GOOGLE_MAPS_API_KEY%&callback=console.debug&libraries=maps,marker&v=beta">
    </script>
  </head>
  <body>
    <gmp-map center="7.8731,80.7718" 
             zoom="8" 
             map-id="8e0a97af9386fef"
             tilt="0">
    </gmp-map>
    <script>
      function initMap() {
        const mapElement = document.querySelector('gmp-map');
        const sriLankaBounds = {
          north: 9.9,
          south: 5.9,
          east: 82.0,
          west: 79.4
        };

        mapElement.addEventListener('gmp-map-initialized', () => {
          const map = mapElement.innerMap;
          map.setOptions({
            restriction: {
              latLngBounds: sriLankaBounds,
              strictBounds: true
            },
            mapTypeId: 'terrain',
            mapTypeControl: false,
            streetViewControl: false,
            fullscreenControl: false,
            zoomControl: true
          });
        });

        const cities = [
          { name: "Colombo", lat: 6.9271, lng: 79.8612, population: "752,993" },
          { name: "Kandy", lat: 7.2906, lng: 80.6337, population: "125,400" },
          { name: "Galle", lat: 6.0535, lng: 80.2210, population: "93,118" },
          { name: "Jaffna", lat: 9.6615, lng: 80.0255, population: "88,138" },
          { name: "Trincomalee", lat: 8.5874, lng: 81.2152, population: "108,420" }
        ];

        cities.forEach(city => {
          const marker = document.createElement('gmp-advanced-marker');
          marker.position = { lat: city.lat, lng: city.lng };
          marker.title = `${city.name} - Population: ${city.population}`;
          marker.setAttribute('background', '#FF0000');
          marker.setAttribute('scale', '1.2');
          marker.setAttribute('type', 'circle');

          marker.addEventListener('mouseover', () => {
            marker.setAttribute('scale', '1.5');
          });
          marker.addEventListener('mouseout', () => {
            marker.setAttribute('scale', '1.2');
          });

          mapElement.appendChild(marker);
        });
      }

      window.addEventListener('load', initMap);
    </script>
  </body>
</html>